con
_clkfreq=338688000
c4=262
d4=294
e4=330
f4=349
g4=392
a4=440
h4=494
obj
audio:"audio2-002.spin2"


pub drivertest()   : cog,base,i
' prepare 8-bit saw wave
repeat i from $40000 to $4001F
  byte[i]:=i*8

' start the driver. It will generate scope data at $60000. It will not use any PSRAM

cog, base:=audio.start(0,$60000,$61000)
debug(udec(cog,base))
{{
Channel registers:
long #0: the sample phase accumulator: use it as read only although you -can- change this while playing (not recommended, the driver cog writes there at every sample)
long #1: the sample phase accumulator high word: 
long #2: the current sample generated, 2 words, right:left
long #3: 2 last raw samples
long #4: Envelope PA
long #5: the sample pointer.
         Set bit #31 to 0 if the sample is 8 bit, 1 for 16 bit.
         Set bit #30 to 1 to start playing the sample from the beginning
         Set bit #29 to 1 to synchronize channels 0 and 1 for playing stereo without the phase error
         Set bit #28 to 1 to use interleaved samples (as in .wav file) with fractional skip enabled
long #6: sample loop start point
long #7: sample loop end point.
         If the sample has to no loop and stop at the end, set loop start=end of sample, loop end=loop start +1 or 2 (for 16 bit)
long #8: volume and pan
         word #10: volume, 0..16384(=1). Values more than 16384 could cause clipping if sample is normalized
         word #11: pan. 16384: full left, 8192: center, 0: full right
long #9  frequency, 8:24, $01000000=sample rate (44100)
        
long #10  bit 31=set sample rate, bit 30 - set sample source (1=hub,0=psram)
}}

' tell it to play


long[base+24]:=0                ' loop start point
long[base+28]:=$20              '
word[base+32]:=16384            ' max volume
long[base+20]:=$40040000        'sample pointer
long[base+36]:=$1000001
repeat
   i:=12174*c4
   long[base+36]:=i
   waitms (1000)
   i:=12174*d4
   long[base+36]:=i
   waitms (1000)
   i:=12174*e4
   long[base+36]:=i
   waitms (1000)
   i:=12174*f4
   long[base+36]:=i
   waitms (1000)
   i:=12174*g4
   long[base+36]:=i
   waitms (1000)
   i:=12174*a4
   long[base+36]:=i
   waitms (1000)
   i:=12174*h4
   long[base+36]:=i
   waitms (1000)
   i:=12174*2*c4
   long[base+36]:=i
   waitms (2000)

   
  'debug(udec(long[base]))
